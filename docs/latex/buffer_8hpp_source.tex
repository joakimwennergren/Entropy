\hypertarget{buffer_8hpp_source}{}\doxysection{buffer.\+hpp}
\label{buffer_8hpp_source}\index{src/graphics/buffers/buffer.hpp@{src/graphics/buffers/buffer.hpp}}
\mbox{\hyperlink{buffer_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <vulkan/vulkan.hpp>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{context_8hpp}{context.hpp}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}vertex.hpp"{}}}
\DoxyCodeLine{17 \textcolor{keyword}{using namespace }Symbios::Core;}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{namespace }Symbios}
\DoxyCodeLine{20 \{}
\DoxyCodeLine{21     \textcolor{keyword}{namespace }Graphics}
\DoxyCodeLine{22     \{}
\DoxyCodeLine{23         \textcolor{keyword}{namespace }Buffers}
\DoxyCodeLine{24         \{}
\DoxyCodeLine{30             \textcolor{keyword}{class }\mbox{\hyperlink{class_symbios_1_1_graphics_1_1_buffers_1_1_buffer}{Buffer}}}
\DoxyCodeLine{31             \{}
\DoxyCodeLine{32             \textcolor{keyword}{public}:}
\DoxyCodeLine{33                 \mbox{\hyperlink{class_symbios_1_1_graphics_1_1_buffers_1_1_buffer}{Buffer}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{34                 \mbox{\hyperlink{class_symbios_1_1_graphics_1_1_buffers_1_1_buffer}{\string~Buffer}}();}
\DoxyCodeLine{35 }
\DoxyCodeLine{36                 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{37                 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} New(std::shared\_ptr<Context> context, T data)}
\DoxyCodeLine{38                 \{}
\DoxyCodeLine{39 }
\DoxyCodeLine{40                     \_context = context;}
\DoxyCodeLine{41 }
\DoxyCodeLine{42                     VkBufferCreateInfo bufferInfo\{\};}
\DoxyCodeLine{43                     bufferInfo.sType = VK\_STRUCTURE\_TYPE\_BUFFER\_CREATE\_INFO;}
\DoxyCodeLine{44                     bufferInfo.size = \textcolor{keyword}{sizeof}(data[0]) * data.size();}
\DoxyCodeLine{45                     bufferInfo.usage = VK\_BUFFER\_USAGE\_VERTEX\_BUFFER\_BIT;}
\DoxyCodeLine{46                     bufferInfo.sharingMode = VK\_SHARING\_MODE\_EXCLUSIVE;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48                     \textcolor{keywordflow}{if} (vkCreateBuffer(\_context-\/>GetLogicalDevice(), \&bufferInfo, \textcolor{keyword}{nullptr}, \&\_buffer) != VK\_SUCCESS)}
\DoxyCodeLine{49                     \{}
\DoxyCodeLine{50                         PLOG\_ERROR << \textcolor{stringliteral}{"{}Failed to create buffer!"{}};}
\DoxyCodeLine{51                         exit(EXIT\_FAILURE);}
\DoxyCodeLine{52                     \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54                     VkMemoryRequirements memRequirements;}
\DoxyCodeLine{55                     vkGetBufferMemoryRequirements(\_context-\/>GetLogicalDevice(), \_buffer, \&memRequirements);}
\DoxyCodeLine{56 }
\DoxyCodeLine{57                     VkMemoryAllocateInfo allocInfo\{\};}
\DoxyCodeLine{58                     allocInfo.sType = VK\_STRUCTURE\_TYPE\_MEMORY\_ALLOCATE\_INFO;}
\DoxyCodeLine{59                     allocInfo.allocationSize = memRequirements.size;}
\DoxyCodeLine{60                     allocInfo.memoryTypeIndex = FindMemoryType(memRequirements.memoryTypeBits, VK\_MEMORY\_PROPERTY\_HOST\_VISIBLE\_BIT | VK\_MEMORY\_PROPERTY\_HOST\_COHERENT\_BIT);}
\DoxyCodeLine{61 }
\DoxyCodeLine{62                     \textcolor{keywordflow}{if} (vkAllocateMemory(\_context-\/>GetLogicalDevice(), \&allocInfo, \textcolor{keyword}{nullptr}, \&\_bufferMemory) != VK\_SUCCESS)}
\DoxyCodeLine{63                     \{}
\DoxyCodeLine{64                         PLOG\_ERROR << \textcolor{stringliteral}{"{}Failed to allocate buffer memory!"{}};}
\DoxyCodeLine{65                         exit(EXIT\_FAILURE);}
\DoxyCodeLine{66                     \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68                     vkBindBufferMemory(\_context-\/>GetLogicalDevice(), \_buffer, \_bufferMemory, 0);}
\DoxyCodeLine{69 }
\DoxyCodeLine{70                     \textcolor{keywordtype}{void} *datatemp;}
\DoxyCodeLine{71                     vkMapMemory(\_context-\/>GetLogicalDevice(), \_bufferMemory, 0, bufferInfo.size, 0, \&datatemp);}
\DoxyCodeLine{72                     memcpy(datatemp, data.data(), (\textcolor{keywordtype}{size\_t})bufferInfo.size);}
\DoxyCodeLine{73                     vkUnmapMemory(\_context-\/>GetLogicalDevice(), \_bufferMemory);}
\DoxyCodeLine{74                 \}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76                 \textcolor{keyword}{inline} VkBuffer GetBuffer() \{ \textcolor{keywordflow}{return} this-\/>\_buffer; \};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78             \textcolor{keyword}{private}:}
\DoxyCodeLine{79                 uint32\_t FindMemoryType(uint32\_t typeFilter, VkMemoryPropertyFlags properties);}
\DoxyCodeLine{80                 std::shared\_ptr<Context> \_context;}
\DoxyCodeLine{81                 VkBuffer \_buffer;}
\DoxyCodeLine{82                 VkDeviceMemory \_bufferMemory;}
\DoxyCodeLine{83             \};}
\DoxyCodeLine{84         \}}
\DoxyCodeLine{85     \}}
\DoxyCodeLine{86 \}}

\end{DoxyCode}
